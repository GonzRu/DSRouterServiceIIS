USE [ptk]
GO
/****** Object:  StoredProcedure [dbo].[ASULightShowUnionLog]    Script Date: 04/21/2014 12:01:54 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
ALTER PROCEDURE [dbo].[ASULightShowUnionLog] 
	-- Add the parameters for the stored procedure here
	@StartDate datetime,
	@EndDate datetime,
	@NeedSystemEvents bit = 1,
	@NeedUserEvents bit = 1,
	@NeedDeviceEvents bit = 1, 
	@BlockID int = 0
	--<@Param1, sysname, @p1> <Datatype_For_Param1, , int> = <Default_Value_For_Param1, , 0>, 

AS
BEGIN
	
	SET NOCOUNT ON;

--= SELECT DATEADD(day, -1, GETDATE()


    SELECT InnerDataID, [Time], ObjName, Comment, [Text], [Source], [Receipt], [ReceiptDate], [ReceiptComment], NEEDReceipt, EventPriority FROM dbo.ASULightLog 
	WHERE 
	(
		[Time] between @StartDate and  @EndDate
	)
	AND 
	((
		@NeedSystemEvents = 1 AND (([Source] = 'Система: стандартные сообщения' ) OR ([Source] = 'Система: события логгера' ))
	)
	OR
	(
		@NeedUserEvents = 1 AND ([Source] = 'Система: события АРМ-а' OR [Source] LIKE 'Пользователь:%')
	)
	OR
	(
		@NeedDeviceEvents = 1 AND ([Source] = 'Система: события терминалов' OR [Source] LIKE 'Терминал:%')
	))
	AND
	(
		(@BlockID > 0 AND BlockID = @BlockID) OR @BlockID < 1
	)
 ORDER BY [Time] DESC
 
END
