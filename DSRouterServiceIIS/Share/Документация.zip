SELECT     dbo.EventLog.ID AS ID, - 1 AS InnerDataID, dbo.EventLog.Time AS [Time], dbo.EventLog.BlockID AS BlockID, dbo.BlockName.BlockName AS ObjName, 
                      dbo.BlockName.Comment AS Comment, 'Событие: ' + dbo.EventMesUnion.EventText AS Text, 'Система: ' + CASE WHEN dbo.EventLog.MesID BETWEEN
                          (SELECT     min(ID)
                            FROM          dbo.EventMes) AND
                          (SELECT     MAX(ID)
                            FROM          dbo.EventMes) THEN 'события терминалов' WHEN dbo.EventLog.MesID BETWEEN
                          (SELECT     min(ID)
                            FROM          dbo.StandartEventMes) AND
                          (SELECT     MAX(ID)
                            FROM          dbo.StandartEventMes) THEN 'стандартные сообщения' WHEN dbo.EventLog.MesID BETWEEN
                          (SELECT     min(ID)
                            FROM          dbo.LoggerEventMes) AND
                          (SELECT     MAX(ID)
                            FROM          dbo.LoggerEventMes) THEN 'события логгера' WHEN dbo.EventLog.MesID BETWEEN
                          (SELECT     min(ID)
                            FROM          dbo.ArmEventMes) AND
                          (SELECT     MAX(ID)
                            FROM          dbo.EventMes) THEN 'события АРМ-а' ELSE '' END AS Source, 'E' AS TypeLog, 
                      CASE WHEN dbo.EventLog.IDReceipt > 0 THEN 'Квитировано пользователем ' + dbo.Users.UserName ELSE NULL END AS Receipt, 
                      CASE WHEN dbo.EventLog.IDReceipt > 0 THEN dbo.Receipt.LocalTime ELSE NULL END AS ReceiptDate, 
                      CASE WHEN dbo.EventLog.IDReceipt > 0 THEN dbo.Receipt.Comment ELSE NULL END AS ReceiptComment, 
                      CASE WHEN dbo.EventLog.IDReceipt > 0 THEN 1 ELSE 0 END AS ReceiptStatus, 
                      CASE WHEN dbo.EventMesUnion.ReceiptComment = 1 THEN 1 ELSE 0 END AS NEEDReceipt, dbo.EventMesUnion.EventPriority
FROM         dbo.EventLog LEFT JOIN
                      dbo.BlockName ON dbo.EventLog.BlockID = dbo.BlockName.Id LEFT JOIN
                      dbo.EventMesUnion ON dbo.EventLog.MesID = dbo.EventMesUnion.ID LEFT JOIN
                      dbo.Receipt ON dbo.EventLog.IDReceipt = dbo.Receipt.ID LEFT JOIN
                      dbo.Users ON dbo.Receipt.UserId = dbo.Users.Id
UNION
SELECT     DataLog.ID AS ID, DataLog.ID AS InnerDataID, DataLog.TimeFC AS [Time], BlockName.Id AS BlockID, BlockName.BlockName AS ObjName, BlockName.Comment, 
                      'Архивные данные (' + RecordType.RecordType + ')' AS Text, 'Терминал: ' + BlockName.BlockName AS Source, 'D' AS TypeLog, NULL AS Receipt, NULL 
                      AS ReceiptDate, NULL AS ReceiptComment, 0 AS ReceiptStatus, 0 AS NEEDReceipt, 9 AS EventPriority
FROM         dbo.DataLog LEFT JOIN
                      dbo.RecordType ON RecordType.ID = DataLog.TypeID LEFT JOIN
                      dbo.BlockName ON DataLog.BlockID = BlockName.Id
UNION
SELECT     dbo.UserLog.Id AS ID, - 1 AS InnerDataID, dbo.UserLog.LocalTime AS [Time], - 1 AS BlockID, dbo.Users.UserName AS ObjName, dbo.Users.Comment, 
                      dbo.UserAction.ActionName AS Text, 'Пользователь: ' + dbo.ArmName.ArmName AS Source, 'U' AS TypeLog, NULL AS Receipt, NULL AS ReceiptDate, NULL 
                      AS ReceiptComment, 0 AS ReceiptStatus, 0 AS NEEDReceipt, 10 AS EventPriority
FROM         dbo.UserLog LEFT JOIN
                      dbo.UserAction ON dbo.UserLog.UserDo = dbo.UserAction.Id LEFT JOIN
                      dbo.Users ON dbo.UserLog.UserId = dbo.Users.Id LEFT JOIN
                      dbo.ArmName ON dbo.UserLog.ArmId = dbo.ArmName.ID
WHERE     (dbo.UserAction.ActionShow = 1)